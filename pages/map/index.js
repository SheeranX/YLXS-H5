

var markers = [{
	"type": 1,		//1：散客步行 2：驾车 	
	"typeId": 1,
	"id": 1001,
    "objectId": 30001,
    "clientId": 007,
    "menuId": 1,
    "name": "团客下车点1",
    "content": "团客下车点1",
    "picPath": "",
    "logo": "images/map_icon_bus.png",
    "longitude": 100.269032, 
    "latitude": 27.093306
},{
	"type": 1,	
	"typeId": 2,
	"id": 1002,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "咨询服务",
    "content": "咨询服务",
    "picPath": "",
    "logo": "images/map_icon_05.png",
    "longitude": 100.269104,
    "latitude": 27.095219
},{
	"type": 1,	
	"typeId": 2,
	"id": 10003,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "咨询服务",
    "content": "咨询服务",
    "picPath": "",
    "logo": "images/map_icon_05.png", 
    "longitude": 100.276201,
    "latitude": 27.104321
},{
	"type": 1,	
	"typeId": 2,
	"id": 1003,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "咨询服务",
    "content": "咨询服务",
    "picPath": "",
    "logo": "images/map_icon_05.png", 
    "longitude": 100.268835,
    "latitude": 27.106443
},{
	"type": 1,	
	"typeId": 2,
	"id": 1004,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "咨询服务",
    "content": "咨询服务",
    "picPath": "",
    "logo": "images/map_icon_05.png",
    "longitude": 100.27771,
    "latitude": 27.109787  
},{
	"type": 1,	
	"typeId": 3,
	"id": 1005,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "云山坪换乘点",
    "content": "云山坪换乘点",
    "picPath": "",
    "logo": "images/map_icon_03.png",
    "longitude": 100.26375,
    "latitude": 27.09649
},
{
	"type": 1,	
	"typeId": 4,
	"id": 1006,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "蓝月谷等候",
    "content": "蓝月谷等候",
    "picPath": "",
    "logo": "images/map_icon_03.png",
    "longitude": 100.267451,
    "latitude": 27.113357
},
{
	"type": 1,	
	"typeId": 5,
	"id": 1007,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "大索道换乘点",
    "content": "大索道换乘点",
    "picPath": "",
    "logo": "images/map_icon_03.png",
    "longitude": 100.270901, 
    "latitude": 27.114691
},{
	"type": 1,	
	"typeId": 6,
	"id": 1008,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "集中职工宿舍",
    "content": "集中职工宿舍",
    "picPath": "",
    "logo": "images/map_icon_02.png",
    "longitude": 100.259672,
    "latitude": 27.093434
},{
	"type": 1,	
	"typeId": 6,
	"id": 1009,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "集中职工宿舍",
    "content": "集中职工宿舍",
    "picPath": "",
    "logo": "images/map_icon_02.png",
    "longitude": 100.258846, 
    "latitude": 27.091569
},{
	"type": 1,	
	"typeId": 7,
	"id": 1010,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "卫生间",
    "content": "卫生间",
    "picPath": "",
    "logo": "images/map_icon_wc.png",
    "longitude": 100.262223,  
    "latitude": 27.094335
},{
	"type": 1,	
	"typeId": 7,
	"id": 1011,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "卫生间",
    "content": "卫生间",
    "picPath": "",
    "logo": "images/map_icon_wc.png",
    "longitude": 100.258576, 
    "latitude": 27.09702
},{
	"type": 1,	
	"typeId": 7,
	"id": 1012,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "卫生间",
    "content": "卫生间",
    "picPath": "",
    "logo": "images/map_icon_wc.png",
    "longitude": 100.264882, 
    "latitude": 27.099416
},{
	"type": 1,	
	"typeId": 7,
	"id": 1013,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "卫生间",
    "content": "卫生间",
    "picPath": "",
    "logo": "images/map_icon_wc.png",
    "longitude": 100.272716,   
    "latitude": 27.103163
},{
	"type": 1,	
	"typeId": 7,
	"id": 1014,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "卫生间",
    "content": "卫生间",
    "picPath": "",
    "logo": "images/map_icon_wc.png",
    "longitude": 100.281663,
    "latitude": 27.108035
},{
	"type": 1,	
	"typeId": 7,
	"id": 1015,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "卫生间",
    "content": "卫生间",
    "picPath": "",
    "logo": "images/map_icon_wc.png",
    "longitude": 100.267685, 
    "latitude": 27.109739
},{
	"type": 1,	
	"typeId": 8,
	"id": 1016,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "印象观演",
    "content": "印象观演",
    "picPath": "",
    "logo": "images/map_icon_02.png",
    "longitude": 100.276758,
    "latitude": 27.10617
},
{
	"type": 1,	
	"typeId": 9,
	"id": 1017,
    "clientId": 007,
    "objectId": 2,
    "menuId": 1,
    "name": "雪厨餐厅",
    "content": "雪厨餐厅",
    "picPath": "",
    "logo": "images/map_icon_02.png",
    "longitude": 100.268511, 
    "latitude": 27.113341
},
{
	"type": 1,	
	"typeId": 10,
	"id": 1018,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "冰川博物馆",
    "content": "冰川博物馆",
    "picPath": "",
    "logo": "images/map_icon_02.png",
    "longitude": 100.272051,
    "latitude": 27.110189
},{
	"type": 1,	
	"typeId": 11,
	"id": 1019,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "商业售卖",
    "content": "商业售卖",
    "picPath": "",
    "logo": "images/map_icon_02.png",
    "longitude": 100.270092, 
    "latitude": 27.111717
},{
	"type": 1,	
	"typeId": 12,
	"id": 1020,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "咨询服务",
    "content": "咨询服务",
    "picPath": "",
    "logo": "images/map_icon_05.png",
    "longitude": 100.270901,
    "latitude": 27.104594
},{
	"type": 1,	
	"typeId": 12,
	"id": 1021,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "咨询服务",
    "content": "咨询服务",
    "picPath": "",
    "logo": "images/map_icon_05.png",
    "longitude": 100.264271, 
    "latitude": 27.101619
},{
	"type": 1,	
	"typeId": 13,
	"id": 1022,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "龙德职工宿舍",
    "content": "龙德职工宿舍",
    "picPath": "",
    "logo": "images/map_icon_02.png",
    "longitude": 100.262996,
    "latitude": 27.092534
},{
	"type": 1,	
	"typeId": 14,
	"id": 1023,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "祭台",
    "content": "祭台",
    "picPath": "",
    "logo": "images/map_icon_02.png",
    "longitude": 100.275967,
    "latitude": 27.101314
},{
	"type": 1,	
	"typeId": 15,
	"id": 1024,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "瑞士馆",
    "content": "瑞士馆",
    "picPath": "",
    "logo": "images/map_icon_02.png",
    "longitude": 100.268907,  
    "latitude": 27.097117
},{
	"type": 1,	
	"typeId": 16,
	"id": 1025,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "配电房",
    "content": "配电房",
    "picPath": "",
    "logo": "images/map_icon_02.png",
    "longitude": 100.258558, 
    "latitude": 27.100494
},{
	"type": 1,	
	"typeId": 17,
	"id": 1026,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "消防队",
    "content": "消防队",
    "picPath": "",
    "logo": "images/map_icon_02.png",
    "longitude": 100.259942,
    "latitude": 27.102455
},{
	"type": 1,	
	"typeId": 18,
	"id": 1027,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "印象职工宿舍",
    "content": "印象职工宿舍",
    "picPath": "",
    "logo": "images/map_icon_02.png",
    "longitude": 0,
    "latitude": 0
},{
	"type": 1,	
	"typeId": 19,
	"id": 1028,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "散客下车点",
    "content": "散客下车点",
    "picPath": "",
    "logo": "images/map_icon_bus.png",
    "longitude": 100.270326, 
    "latitude": 27.107022
},{
	"type": 1,	
	"typeId": 20,
	"id": 1029,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "团客下车点2",
    "content": "团客下车点2",
    "picPath": "",
    "logo": "images/map_icon_bus.png",
    "longitude": 100.25969,
    "latitude": 27.098323
},{
	"type": 1,	
	"typeId": 21,
	"id": 1030,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "环保大巴下车点",
    "content": "环保大巴下车点",
    "picPath": "",
    "logo": "images/map_icon_bus.png",
    "longitude": 100.264792, 
    "latitude": 27.109016
},{
	"type": 1,	
	"typeId": 22,
	"id": 1031,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "蓝月谷上车点",
    "content": "蓝月谷上车点",
    "picPath": "",
    "logo": "images/map_icon_bus.png",
    "longitude": 100.267685, 
    "latitude": 27.114113
},{
	"type": 1,	
	"typeId": 23,
	"id": 1032,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "大索道上车点",
    "content": "大索道上车点",
    "picPath": "",
    "logo": "images/map_icon_bus.png",
    "longitude": 100.272913,  
    "latitude": 27.114916
},{
	"type": 1,	
	"typeId": 24,
	"id": 1033,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "云杉坪上车点",
    "content": "云杉坪上车点",
    "picPath": "",
    "logo": "images/map_icon_bus.png",
    "longitude": 100.262187,  
    "latitude": 27.093145
},{
	"type": 1,	
	"typeId": 25,
	"id": 1034,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "职工餐厅",
    "content": "职工餐厅",
    "picPath": "",
    "logo": "images/map_icon_02.png",
    "longitude": 100.261002, 
    "latitude": 27.095107
},{
	"type": 1,	
	"typeId": 26,
	"id": 1035,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "车队办公",
    "content": "车队办公",
    "picPath": "",
    "logo": "images/map_icon_02.png",
    "longitude": 100.260499, 
    "latitude": 27.091553
},{
	"type": 1,	
	"typeId": 27,
	"id": 1036,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "环保大巴车库",
    "content": "环保大巴车库",
    "picPath": "",
    "logo": "images/map_icon_bus.png",
    "longitude": 100.258091, 
    "latitude": 27.093756
},{
	"type": 1,	
	"typeId": 28,
	"id": 1037,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "半开放马棚",
    "content": "半开放马棚",
    "picPath": "",
    "logo": "images/map_icon_02.png",
    "longitude": 100.278303,  
    "latitude": 27.103629
},
{
	"type": 2,	
	"typeId": 31,
	"id": 1041,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "临时停车场",
    "content": "临时停车场",
    "picPath": "",
    "logo": "images/map_icon_p.png",
    "longitude": 100.254767, 
    "latitude": 27.090717
},{
	"type": 2,	
	"typeId": 31,
	"id": 1042,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "一号停车场",
    "content": "一号停车场",
    "picPath": "",
    "logo": "images/map_icon_p.png",
    "longitude": 100.256672, 
    "latitude": 27.092132
},{
	"type": 2,	
	"typeId": 31,
	"id": 1043,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "二号停车场",
    "content": "二号停车场",
    "picPath": "",
    "logo": "images/map_icon_p.png",
    "longitude": 100.262169, 
    "latitude": 27.099657
},{
	"type": 2,	
	"typeId": 31,
	"id": 1044,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "三号停车场",
    "content": "三号停车场",
    "picPath": "",
    "logo": "images/map_icon_p.png",
    "longitude": 100.284088, 
    "latitude": 27.103452
},{
	"type": 2,	
	"typeId": 31,
	"id": 1045,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "四号停车场",
    "content": "四号停车场",
    "picPath": "",
    "logo": "images/map_icon_p.png",
    "longitude": 100.267451, 
    "latitude": 27.106893
},{
	"type": 2,	
	"typeId": 31,
	"id": 1046,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "五号停车场", 
    "content": "五号停车场",
    "picPath": "",
    "logo": "images/map_icon_p.png",
    "longitude": 100.283693, 
    "latitude": 27.107762
},{
	"type": 2,	
	"typeId": 31,
	"id": 1047,
    "clientId": 007,
    "objectId": 0,
    "menuId": 1,
    "name": "六号停车场",
    "content": "六号停车场",
    "picPath": "",
    "logo": "images/map_icon_p.png",
    "longitude": 100.276111, 
    "latitude": 27.113485
}];
try{
    var map = (function(){
        var lineArr = [];
        // var _obj = paras||{imgUrl:'tiles/bg.png',point:{lat:'',poi:''}};//var map = (function(){})(); point /url
        //添加瓦片图
        function initMap(elem){
            var tileLayer = new BMap.TileLayer({isTransparentPng:true});
            tileLayer.getTilesUrl = function(tileCoord,zoom){
                var x = tileCoord.x;
                var y = tileCoord.y;
                var imgUrl = "tiles/bg.png";
                if(zoom == 15 && (x < 5755 || x > 5758 || y < 1655 || y > 1657)) {
                    imgUrl = "tiles/bg.png";
                }else if(zoom == 16 && (x < 10896 || x > 10903 || y < 3041 || y > 3045)) {
                    imgUrl = "tiles/bg.png";
                }else if(zoom == 17 && (x < 21792 || x > 21807 || y < 6083 || y > 6090)) {
                    imgUrl = "tiles/bg.png";
                }else{
                    imgUrl = 'tiles/' + zoom + '/tile-' + x + '_' + y + '.png';
                }
                return imgUrl
            }
    
            //设置地图基础参数，此设置会隐藏图层下的真实地图
            var myMap = new BMap.MapType('MyMap',tileLayer,{
                minZoom: 16,
                maxZoom: 17,
                enableMapClick:false
            });
        
            //map.addTileLayer(tileLayer);
            var map = new BMap.Map('allmap',{mapType:myMap});
            //地图控件
          //  map.addControl(new BMap.NavigationControl());
             //地图定点显示
            var point = new BMap.Point(100.274559, 27.108653);
            map.centerAndZoom(point,16);
            map.enableScrollWheelZoom();
        }
        var tileLayer = new BMap.TileLayer({isTransparentPng:true});
        tileLayer.getTilesUrl = function(tileCoord,zoom){
            var x = tileCoord.x;
            var y = tileCoord.y;
            var imgUrl = "tiles/bg.png";
            if(zoom == 15 && (x < 5755 || x > 5758 || y < 1655 || y > 1657)) {
                imgUrl = "tiles/bg.png";
            }else if(zoom == 16 && (x < 10896 || x > 10903 || y < 3041 || y > 3045)) {
                imgUrl = "tiles/bg.png";
            }else if(zoom == 17 && (x < 21792 || x > 21807 || y < 6083 || y > 6090)) {
                imgUrl = "tiles/bg.png";
            }else{
                imgUrl = 'tiles/' + zoom + '/tile-' + x + '_' + y + '.png';
            }
            return imgUrl
        }

        //设置地图基础参数，此设置会隐藏图层下的真实地图
        var myMap = new BMap.MapType('MyMap',tileLayer,{
            minZoom: 16,
            maxZoom: 17,
            enableMapClick:false
        });
    
        //map.addTileLayer(tileLayer);
        var map = new BMap.Map('allmap',{mapType:myMap});
        //地图控件
      //  map.addControl(new BMap.NavigationControl());
         //地图定点显示
        var point = new BMap.Point(100.274559, 27.108653);
        map.centerAndZoom(point,16);
        map.enableScrollWheelZoom();
        //添加标注
        var addMarker = function (markers){
            markers.forEach(function(item,i){
                callAddMarkers(item);
           });
        }(markers)
    
       //添加点击事件
       var click = addClick(function(e){
         var lng = e.point.lng;
         var lat = e.point.lat;
         console.log(e.point.lng + "," + e.point.lat+'point position');
    
         callAddMarkers({'longitude':lng,'latitude':lat});
         paintLine({'longitude':lng,'latitude':lat});
	     $('.modal').animate({height:"1.3rem"});
	       
	    });
    
       //removeClick(click);
    
       //添加标注方法
       function addMarkers(){
         var lon = this.longitude;
         var lat = this.latitude;
         var iconUrl = this.logo;
         var label = this.name;
         var num = this.num;
        //标注图标
         var pt = new BMap.Point(lon,lat);
         
         var icon = new BMap.Icon(iconUrl,new BMap.Size(30,35));
    
         var _marker =  iconUrl ? new BMap.Marker(pt,{icon:icon}) : new BMap.Marker(pt);

         _marker.addEventListener('click',function(e){
             console.log('++'+'marker');
             matchPoi(markers,lon,lat);
             $('.modal').animate({height:"1.0rem"});
         });
         
         if(label)
         {
             //标注文本
             var _label = new BMap.Label(label,{offset:new BMap.Size(10,-20)});
            _marker.setLabel(_label);
         }
         if(num>0)
         {
             //标注文本序号
             var _labelNum = new BMap.Label(num,{offset:new BMap.Size(3,3)});
             
             _labelNum.setStyle({
                 color : "#fff",
                 borderRadius:'50%',
                 backgroundColor:'transparent',
                 fontSize:'10px',
                 border:'0px'
              });
              _marker.setLabel(_labelNum);
         }
         map.addOverlay(_marker);
         _marker.disableMassClear();//禁止marker被clearOverlays方法移除
         
         return _marker
       }
       
       //点击事件
       function addClick(callback){
           //单击获取点击的经纬度
            var _callback = callback||function(){};
    
            map.addEventListener("click",callback);
            return _callback
       }
    
       //移除点击事件 
       function removeClick(callbackName){
            map.removeEventListener('click',callbackName);
       }
       //调用添加标注方法
       function callAddMarkers(obj){
          addMarkers.call(obj);
       }
    
       //根据坐标点移动地图
       function move(lon,lat){
           map.panTo(new BMap.Point(lon,lat));
       }
       //删除折线覆盖物
       function removeLine(arr){
         map.clearOverlays();
         arr.forEach(function(item){
            map.removeOverlay(item);
         })
       }
       //画线方法
       function line(){
        var polyline = new BMap.Polyline(lineArr,{
            strokeColor:'red',
            strokeWeight:2,
            strokeOpacity:0.5
        });
        map.addOverlay(polyline);
       }


       function paintLine(obj){
        var lat = obj.latitude;
        var lon = obj.longitude;
        var pt = new BMap.Point(lon,lat);
       
        removeLine();//每次绘制时都进行一次清除覆盖物的操作
        var marker = addMarkers.call(obj);
        removeLine(lineArr);//每次绘制时都进行一次清除覆盖物的操作
        addDel(marker);
        if(lineArr.length>1) 
        {
            line();
        }
       }
       
        
       //创建右键删除菜单
       function addDel(marker){
	        var removeMarker = function(e,ee,m){//回调
	            map.removeOverlay(m);
	            console.log(m.point);
	            lineArr.forEach(function(item,i){
	                if(item.equals(m.point))
	                {
	                    removeLine();
	                    lineArr.splice(i,1);
	                    line();
	                }
	            });
	        }
            //创建右键菜单
            var markerMenu=new BMap.ContextMenu();
            markerMenu.addItem(new BMap.MenuItem('删除',removeMarker.bind(marker)));
    
            marker.addContextMenu(markerMenu);
       }

    //计算两点之间的距离,poiA = 起始点，poiB = 终点
    function getDis(poiA,poiB){
        return map.getDistance(poiA,poiB).toFixed(2);
    }
    
    })();
}catch(e){
    alert(e);
}

try{
    var audio = (function(){
    
        function init(obj){
            var ele = obj.element
            $("#"+ele).children().remove();
    
            document.getElementById(ele).className="aplayer";
            var ap1 = new APlayer({
                element:document.getElementById(ele),
                narrow: true,
                autoplay: false,
                showlrc: false,
                music:obj.music
            });
        //    ap1.init();
            return ap1
        }
    
        return {
            init:init
        }
    })();
}
catch(e){
    alert(e);
}

audio.init({
        element:'audio',
        music:{
            title: 'Sugar',
            author: 'Maroon 5',
            url: '../../images/aa.mp3',
            pic: '../../images/zz.jpg'
        }
    });

$(function(){
    window.swiperAudio = [];
    var swiper = new Swiper('.swiper-container',ctrlAudio());
    var swiperNav = new Swiper('.swiper-nav',{
        slidesPerView: 5,
        spaceBetween: 0,
        freeMode: true,
    });
    var navItem = [{id:'0',title:'景点',icon:'&#xe605;'},
                   {id:'1',title:'路线',icon:'&#xe657;'},
                   {id:'2',title:'厕所',icon:'&#xe60d;'},
                   {id:'3',title:'服务',icon:'&#xe61f;'},
                   {id:'4',title:'商家',icon:'&#xe60f;'},
                   {id:'5',title:'商家',icon:'&#xe60f;'}];

    var arrItem = [];
    $.each(navItem,function(i,item){//'+(i==0?"tab-click":"")+'
        arrItem.push('<div class="swiper-slide"><div class="scenic flex-column txt-align-center" id="scenic" data-content="navItemContent_'+i+'" data-id="'+item.id+'">'
                        +'<span class="layui-icon font28">'+item.icon+'</span><span class="font14">'+item.title+'</span></div></div>');
        $('.nav-item-content').append($('<ul class="flex-column font12" id="navItemContent_'+i+'" data-idx="'+item.id+'"></ul>'));
    });
    swiperNav.appendSlide(arrItem);
    $('.modal').animate({height:0});
    
    $('.collapse').click(function(){
        $('.nav-item-content').slideToggle(300);
        if($(this).find('span').hasClass('layui-icon-up')){
             $(this).find('span').removeClass('layui-icon-up');
        }
        else
        {
            $(this).find('span').addClass('layui-icon-up');
        }
     });

     addItem('navItemContent_0','0');
     //点击列表时触发的事件
     $('ul','.nav-item-content').on('click',"li",function(){
         if($(this).hasClass('active')) return

         $(this).addClass('active').siblings().removeClass('active');

         var mark = $(this).parent().attr('data-idx');
         console.log(mark);
         switch(mark)
         {
             //景点列表项
             case '0':
             var text =  $(this).find('.item-title').text();
             audio.init({
                element:'audio',
                music:{
                    title: text,
                    author: '景区',
                    url: '../../images/aa.mp3',
                    pic: '../../images/weather-rain.png'
                }
             });
             $('.broadcast').animate({top:'0.1rem'});//显示顶部播报栏
             $('.modal').animate({height:"1.0rem"});//显示详情栏 
             $('.audio-title').text(text);
             break;
            case '1':
            //to do ajax 
            var data = [{id:'1',title:'优山美地'},{id:'2',title:'莫哈维'},{id:'3',title:'卡特农神庙'}];
            swiper.removeAllSlides();//移除audio Dom
            removeAudio(swiperAudio,true);//移除audio实例
            $.each(data,function(i,item){
                var str = '<div class="swiper-slide">'
                            +'<div class="flex-row bg-white"><div id="routeAudio_'+i+'"></div><div class="padding-between audio-title font12">优胜美地国家森林公园'+i+'</div></div>'
                            +'</div>';
                swiper.appendSlide(str);
                swiper.updateSlides();
                swiper.slideTo(0);
                
                swiperAudio.push(audio.init({
                    element:'routeAudio_'+i+'',
                    music:{
                        title: 'Sugar',
                        author: 'Maroon 5',
                        url: '../../images/aa.mp3',
                        pic: '../../images/zz.jpg'
                    }
                }));
            });
           // swiper.addSlide(0,html);
            break;
            case '2':
            // to do
            break
            case '3':
            //to do 
            break
            case '4':
            //to do
            break
         }
     });
     //初始化数据
   //  addItem('navItemContent_1','0');
     //关闭浮窗
     $('.icon-close').click(function(){
         $(this).parent().animate({height:0},'fast');
     });
     
     $('#navBar').children().each(function(i,item){
         var id = $(item).find('.flex-column').attr('data-content');
     
         $(item).on('click',function(){
             if($('.nav-item-content').css('display')==='none')
                  $('.collapse').trigger('click');
             if($(this).hasClass('tab-click'))
                 return ;
             else
             {
                 //切换效果
                 $(this).addClass("tab-click").siblings().removeClass('tab-click');
                 swiper.removeAllSlides();//移除swiper内容
                 $('.broadcast').animate({top:'-10rem'});//隐藏顶部播报
                 $('.modal').animate({height:0});//隐藏详情缩略图
                 addItem(id,'0');
             }
         });
     });
})

//移除列表项
function removeDiv(ele){
    $("#"+ele).children().remove();
}

//添加列表项
function addItem(ele,para){
    loading(ele);

    $('#'+ele).removeClass('hide').siblings().addClass('hide');

    var temp = [{id:'1',title:'浙江'},{id:'2',title:'优胜美地国家森林公园'},{id:'3',title:'圣托里尼'},{id:'4',title:'威尼斯'},{id:'5',title:'亚马逊'},{id:'6',title:'莫哈维'}];
    //模拟异步加载
        var template = '';
        $.each(temp,function(i,item){
            template += '<li class="'+(i==0?'active':'')+'"><span class="layui-icon layui-icon-speaker font16"></span> <span class="item-title" id='+item.id+'>'+item.title+'</span></li>';
        });
    
        $('#'+ele).html(template);
    //todo
}
//加载中动效
function loading(ele){
    //to do 添加无数据提示
    var $ele =  $("#"+ele);
    removeDiv(ele);
    var style= "layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop info font28";
    var template = "<div class='txt-align-center' style='height:1.2rem;line-height:1.2rem;'>"
                    +"<span class='"+style+"'></span></div>";

    $ele.html(template);
}

//打开详情页
function details(){
    toast.modalFloat();
}

//控制音频播放

function ctrlAudio(){
    return {
        on:{
            slideChangeTransitionEnd: function(){
                var idx = this.activeIndex;
               swiperAudio.map(function(item,index){
                    if(index==idx)
                        item.play();
                    else
                        item.pause();
                });
            },
        }
    }
}
//移除audio
/**
 * @param {string,boolean,array} para
 * @param {boolean} 是否清除 swiperAudio
 */
function removeAudio(para,isClear){

    if(para)
    {
        if(Array.isArray(para))
        {
            $.each(para,function(i,item){
                item.destroy();
            });
           if(isClear) window.swiperAudio = [];
        }

       else
         para.destroy();
    }
    else
        return
}

function matchPoi(markerArr,lon,lat){
    markerArr.forEach(function(item,i){
        if((item.longitude==lon)&&(item.latitude==lat))
        {
            $('strong','.modal-title').text(item.name);
            $('p','.modal-content').text(item.content);
            $('img','.modal-img').attr('src',item.logo);
            return
        }
    });
}

